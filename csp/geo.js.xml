<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="geo.js" application="/csp/iknowsocial/" default="1"><![CDATA[
function GeoPoint(latitude, longitude) {
	this.latitude = latitude;
	this.longitude = longitude;
}

function toRadians(degree) {
    return (degree * (Math.PI / 180));
}

function CalcHaversineDistance(lat1, lat2, lon1, lon2) {
	var lat1 = toRadians(lat1);
	var lon1 = toRadians(lon1);
	var lat2 = toRadians(lat2);
	var lon2 = toRadians(lon2);
    var R = 6372.8; // Earth radius, km
    var dLat = lat2 - lat1;
    var dLon = lon2 - lon1;
    var a = Math.sin(dLat / 2) * Math.sin(dLat /2) + Math.sin(dLon / 2) * Math.sin(dLon /2) * Math.cos(lat1) * Math.cos(lat2);
    var c = 2 * Math.asin(Math.sqrt(a));
	return R * c;
}

GeoPoint.prototype.getDistance = function(anotherGeoPoint) {
	if (anotherGeoPoint instanceof GeoPoint) {
		return CalcHaversineDistance(this.latitude, anotherGeoPoint.latitude, this.longitude, anotherGeoPoint.longitude)
	} else {
		return undefined;
	}
}

GeoPoint.prototype.toTuple = function() {
	return [this.latitude, this.longitude];
}

GeoPoint.clusterize = function(points, centers) {
	// this is very inefficient
	
	var array = []
	for (var i = 0; i < centers.length; i++) {
		array.push([])
	}
	
	for (var point in points) {
		var distToCenters = centers.map(function(center) {
			return point.getDistance(center);
		}); 
		var minDist = Math.min.apply(Math, distToCenters);
		var minIndex = distToCenters.indexOf(minDist);
		array[minIndex].push(point);
	}
	
	return array;
}

function GeoPost(rawObject) {
	GeoPoint.call(this, rawObject.latitude, rawObject.longitude)
	for (key in rawObject) {
		if (key != "latitude" && key != "longitude") {
			this[key] = rawObject[key];
		}
	}
}

GeoPost.prototype = new GeoPoint();

GeoPost.getFromPosts = function() {
	var array = []
	//console.log(posts)
	for (var i = 0; i < posts.length; i++) {
		//console.log(posts[i]);
		if (posts[i].latitude != "" && posts[i].longitude != "") {
			array.unshift(new GeoPost(posts[i]));
		}
	}
	return array;
}

var UkraineCities = {
  	"Lviv" 			: new GeoPoint(49.8397, 24.0297),
  	"Donetsk" 		: new GeoPoint(48.0159, 37.8029),
  	"Kyiv" 			: new GeoPoint(50.4501, 30.5234),
  	"Odesa"		 	: new GeoPoint(46.4846, 30.7326),
  	"Sumy" 			: new GeoPoint(50.9077, 34.7981),
  	"Kharkiv" 		: new GeoPoint(49.9935, 36.2304)
}]]></CSP>
</Export>
