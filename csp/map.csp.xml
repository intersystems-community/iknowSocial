<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="map.CSP" application="/csp/iknowsocial/" default="1"><![CDATA[
<html>
<head>
  <title>Map Colorer</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="http://code.shutterstock.com/rickshaw/rickshaw.css">
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" >
  <link rel="stylesheet" href="custom.css">
  <style>
  	#map {
	  	height: 80vh;
  	}
  </style>
  <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rickshaw/1.5.1/rickshaw.min.js"></script>
  <script src="custom.js"></script>
  <script src="geo.js"></script>
  <script src="chart.js"></script>
  <script language="JavaScript">
  	var emotionalCircles = L.layerGroup([]);
    var postsMarkers = L.layerGroup([]);
    
    $(document).on("click", "#trends-table .link-to-full-source", function () {
	    #call(TWReader.UIBroker.AddMorePostsWithinContext(0, 100, $(this).text(), 1, "['title', 'EC']", "#map-table"))#
	});
  	
  	$(document).ready(function() {
	  	var map = L.map('map');
    	map.on('load', function() {
	    	console.log("load");
	    	redrawMapbox(map);
    	});
    	map.setView([49, 32], 5);
    	
    	postCallback = function() {
  			posts = GeoPost.getFromPosts(posts);
  			console.log(posts);
  			drawPostsMarkers(postsMarkers, posts, map);
    		drawEmotionalCircles(emotionalCircles, posts, map);
    		drawTrendsGraph(posts);
  		}
    	
    	function redrawMapbox(map) {
	    	var boundsSW = map.getBounds()._southWest;
	    	var boundsNE = map.getBounds()._northEast;
	    	console.log(boundsNE.lat, getCutLong(boundsSW.lng), boundsSW.lat, getCutLong(boundsNE.lng));
	    	#call(TWReader.UIBroker.SavePosts("","0","100", boundsNE.lat, getCutLong(boundsSW.lng), boundsSW.lat, getCutLong(boundsNE.lng)))#
    	}
    	
    	L.tileLayer('http://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
      		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> and <a href="http://geonames.org/">GeoNames</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
      		maxZoom: 18
    	}).addTo(map);
    	
    	// event listeners are separated, because otherwise setView fires them all
    	map.on('zoomend', function() {
	    	redrawMapbox(map);
    	});
    	map.on('moveend', function() {
	    	redrawMapbox(map);
    	});
    	
	});
  </script>
</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">Map Colorer</a>
      </div>
      <div class="collapse navbar-collapse">
      </div>
    </div>
  </nav>
  <div class="container">
    <div class="row" style="margin-top:10px">
      <!---<div class="col-md-3">
        <div class="panel panel-default">
          <table class="table table-striped">
              <thead>
                <tr>
                  <th class="trends-source">Trends</th>
                </tr>
              </thead>
          </table>
          <div class="table-content big-content-wrapper">
            <table class="table table-striped" id="trends-table">
              <tbody>
              	 <script language="JavaScript">
              	 	#call(TWReader.UIBroker.DrawTrends("['sourceId']","#trends-table","46.4846","30.7326"))#
               </script>
              </tbody>
            </table>
          </div>
        </div>
      </div>--->
      <div class="col-md-6">
      	<div class="panel panel-default">
        	<div id="map" class="panel-body big-content-wrapper"></div>
        	<div class="panel-footer"><a data-toggle="modal" data-target="#what-are-circles-modal">What are these circles?</a></div>
        </div>
      </div>
      
      <div class="col-md-6">
      	<div class="panel panel-default">
      		<div id="trends-chart"> </div>
      		
      	</div>
      	<div id="preview"></div>
      </div>
    </div>
    </div>
  </div>

<div class="modal fade" id="what-are-circles-modal" tabindex="-1" role="dialog" aria-labelledby="circles-description" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">What are these circles?</h4>
        </div>
        <div class="modal-body">
          <p>Circles are here to express emotional coloring of what is going on there in social networks. Based on georgaphy of posts you have already downloaded and awesome iKnow sentiment analysis features, we calculate emotional assesment for every single piece of information we have and show it on map for the biggest cities. Circles color is for type of emotions: green is usually posistive, while red is negative or something. Circles radius is closely related to density of posts nearby.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Got it!</button>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
]]></CSP>
</Export>
