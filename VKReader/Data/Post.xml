<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="VKReader.Data.Post">
<Description><![CDATA[
This class mirrors (with some properties disabled) functionality of vk post class.<br>
For more information see: http://vk.com/dev/post
This version ignores reposting.]]></Description>
<Super>%Persistent</Super>
<TimeCreated>63475,60435.629485</TimeCreated>

<Property name="ID">
<Type>%Integer</Type>
<Required>1</Required>
<Parameter name="MINVAL" value="0"/>
</Property>

<Property name="OwnerID">
<Type>%Integer</Type>
<Required>1</Required>
</Property>

<Property name="FromID">
<Type>%Integer</Type>
<Required>1</Required>
</Property>

<Property name="Date">
<Type>%Date</Type>
</Property>

<Property name="Time">
<Type>%Time</Type>
</Property>

<Property name="Text">
<Type>%GlobalCharacterStream</Type>
</Property>

<Property name="FriendsOnly">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="CommentsCount">
<Type>%Integer</Type>
<Parameter name="MINVAL" value="0"/>
</Property>

<Property name="LikesCount">
<Type>%Integer</Type>
<Parameter name="MINVAL" value="0"/>
</Property>

<Property name="RepostsCount">
<Type>%Integer</Type>
<Parameter name="MINVAL" value="0"/>
</Property>

<Property name="PostType">
<Type>%String</Type>
<Required>1</Required>
<Parameter name="VALUELIST" value="-post-copy-reply-postpone-suggest"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^VKReader.Data.PostD</DataLocation>
<DefaultData>PostDefaultData</DefaultData>
<IdLocation>^VKReader.Data.PostD</IdLocation>
<IndexLocation>^VKReader.Data.PostI</IndexLocation>
<StreamLocation>^VKReader.Data.PostS</StreamLocation>
<Data name="PostDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>ID</Value>
</Value>
<Value name="3">
<Value>OwnerID</Value>
</Value>
<Value name="4">
<Value>FromID</Value>
</Value>
<Value name="5">
<Value>Date</Value>
</Value>
<Value name="6">
<Value>Time</Value>
</Value>
<Value name="7">
<Value>Text</Value>
</Value>
<Value name="8">
<Value>ReplyOwnerID</Value>
</Value>
<Value name="9">
<Value>ReplyPostID</Value>
</Value>
<Value name="10">
<Value>FriendsOnly</Value>
</Value>
<Value name="11">
<Value>CommentsCount</Value>
</Value>
<Value name="12">
<Value>LikesCount</Value>
</Value>
<Value name="13">
<Value>RepostsCount</Value>
</Value>
<Value name="14">
<Value>PostType</Value>
</Value>
</Data>
</Storage>

<Method name="%OnNew">
<Description><![CDATA[
This callback method is invoked by the <METHOD>%New</METHOD> method to 
provide notification that a new instance of an object is being created.

<P>If this method returns an error then the object will not be created.
<p>It is passed the arguments provided in the %New call.
When customizing this method, override the arguments with whatever variables and types you expect to receive from %New().
For example, if you're going to call %New, passing 2 arguments, %OnNew's signature could be:
<p>Method %OnNew(dob as %Date = "", name as %Name = "") as %Status
If instead of returning a %Status code this returns an oref and this oref is a subclass of the current
class then this oref will be the one returned to the caller of %New method.]]></Description>
<FormalSpec>oProxy:%ZEN.proxyObject</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if (oProxy '= "") {
		set ..ID = oProxy."id"
		set ..OwnerID = oProxy."owner_id"
		set ..FromID = oProxy."from_id"
		do ..Text.Write(oProxy."text")
		set ..PostType = oProxy."post_type"
		if (oProxy."friends_only" '= "") {
			set ..FriendsOnly = oProxy."friends_only"
		}
		set ..LikesCount = oProxy."likes"."count"
		set ..RepostsCount = oProxy."reposts"."count"
		set ..CommentsCount = oProxy."comments"."count"
		do ##class(VKReader.Utils).ConvertUnixTimeToHorolog(oProxy."date", .horologDate, .horologTime)
		set ..Date = horologDate
		set ..Time = horologTime
	} 
	set status = ..%ValidateObject()
	quit status
]]></Implementation>
</Method>

<Method name="HasValidIntegerFields">
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	quit (##class(VKReader.Utils).IsInteger(..ID) && ##class(VKReader.Utils).IsInteger(..OwnerID) && ##class(VKReader.Utils).IsInteger(..FromID)
	&& ##class(VKReader.Utils).IsInteger(..CommentsCount) && ##class(VKReader.Utils).IsInteger(..LikesCount) && ##class(VKReader.Utils).IsInteger(..RepostsCount))
]]></Implementation>
</Method>

<Method name="%OnValidateObject">
<Description><![CDATA[
This callback method is invoked by the <METHOD>%ValidateObject</METHOD> method to 
provide notification that the current object is being validated.

<P>If this method returns an error then <METHOD>%ValidateObject</METHOD> will fail.]]></Description>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if ('..HasValidIntegerFields()) {
		set status = $system.Status.Error(5001, "Invalid integers values.")
		quit status
	}
	quit $$$OK
]]></Implementation>
</Method>
</Class>
</Export>
