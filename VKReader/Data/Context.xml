<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="VKReader.Data.Context">
<IncludeCode>%IKPublic</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>63489,67555.308498</TimeCreated>

<Property name="RelatedQuery">
<Type>%String</Type>
<Parameter name="MINLEN" value="2"/>
</Property>

<Property name="DomainID">
<Type>%Integer</Type>
</Property>

<Property name="Domain">
<Type>%iKnow.Domain</Type>
</Property>

<Parameter name="ConfigurationName">
<Type>%String</Type>
<Default>VKAPIConfiguration</Default>
</Parameter>

<Parameter name="DomainName">
<Type>%String</Type>
<Default>VKAPIDomain</Default>
</Parameter>

<Method name="SetDomain">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set ..DomainID = ##class(%iKnow.Domain).GetOrCreateId(..#DomainName)
	set ..Domain = ##class(%iKnow.Domain).OpenId(..DomainID)
	if ##class(%iKnow.Configuration).Exists(..#ConfigurationName) {
    	set cfg = ##class(%iKnow.Configuration).Open(..#ConfigurationName) 
    }else {
		set cfg = ##class(%iKnow.Configuration).%New(..#ConfigurationName, 1, $LB("ru"))
        do cfg.%Save() 
    }
    set status = ..Domain.SetParameter($$$IKPDEFAULTCONFIG, ..#ConfigurationName)
    quit status
]]></Implementation>
</Method>

<Method name="ClearDomain">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set status = ..Domain.DropData()
	quit status
]]></Implementation>
</Method>

<Method name="AddMorePosts">
<FormalSpec>count:%Integer=10,checkExists:%Boolean=1,startDate:%Date="",startTime:%Time="",endDate:%Date="",endTime:%Time=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set lister = ##class(VKReader.Lister).%New(..DomainID)
	set status = lister.ProcessList(..RelatedQuery, count, checkExists, startDate, startTime, endDate, endTime)
	quit status
]]></Implementation>
</Method>

<Method name="%OnNew">
<FormalSpec>query:%String,clearDomain:%Boolean=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set ..RelatedQuery = query
	set status = ..SetDomain()
	if (clearDomain = 1) {
		set status = $$$ADDSC(status, ..ClearDomain())
	}
	Quit status
]]></Implementation>
</Method>
</Class>
</Export>
