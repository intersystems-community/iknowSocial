<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="TWReader.Data.Context">
<IncludeCode>%IKPublic</IncludeCode>
<Super>Util.Data.Context</Super>
<TimeCreated>63489,67555.308498</TimeCreated>

<Parameter name="ConfigurationName">
<Type>%String</Type>
<Default>TWAPIConfiguration</Default>
</Parameter>

<Parameter name="DomainName">
<Type>%String</Type>
<Default>TWAPIDomain</Default>
</Parameter>

<Method name="AddMorePosts">
<FormalSpec>query:%String,count:%Integer=10,checkExists:%Boolean=1,startDate:%Date="",startTime:%Time="",endDate:%Date="",endTime:%Time=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set lister = ##class(TWReader.Lister).%New(..DomainID)
    set status = lister.ProcessList(query, count, checkExists, startDate, startTime, endDate, endTime)
    quit status
]]></Implementation>
</Method>

<Method name="AddMorePersistentPosts">
<FormalSpec>query:%String,count:%Integer=10,checkExists:%Boolean=1,startDate:%Date="",startTime:%Time="",endDate:%Date="",endTime:%Time=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set status = ##class(TWReader.Requests.Api).TweetsSearch(.response, 
                                                             $lb(query, count, checkExists, 
                                                                 startDate, startTime, endDate, endTime))
    quit:$$$ISERR(status) status
    
    set tweets = ##class(%ArrayOfObjects).%New()
    set tweets = response.GetAt(1)."statuses"
    
    for i = 1:1:tweets.Count() {
        #dim tweet As TWReader.Data.Tweet = ##class(TWReader.Data.Tweet).%New(tweets.GetAt(i))
        #dim user As TWReader.Data.User   = ##class(TWReader.Data.User).%New(tweet.User)

        set status = tweet.%Save() quit:$$$ISERR(status)
        set status = user.%Save() quit:$$$ISERR(status)
    }

    quit $$$OK
]]></Implementation>
</Method>
</Class>
</Export>
